<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>STARRY-S' Blog</title>
  <subtitle>Morning.</subtitle>
  <icon>https://blog.starry-s.me/images/avatar.jpg</icon>
  <link rel="self" type="application/atom+xml" href="https://blog.starry-s.me/atom.xml" />
  
  <link rel="alternate" type="text/html" href="https://blog.starry-s.me/" />
  
  <updated>2020-07-19T07:29:57.000Z</updated>
  
  <id>https://blog.starry-s.me/</id>
  
  <author>
    <name>STARRY-S</name>
    <email>hx916584160@gmail.com</email>
  </author>
  
  <generator uri="https://github.com/AlynxZhou/hikaru-generator-feed/" version="2.2.4">Hikaru Generator Feed</generator>
  
  
  
  
  
  <entry>
    <title>惠普光影精灵4在Arch Linux下使用Optimus Manager配置双显卡</title>
    <link rel="alternate" type="text/html" href="https://blog.starry-s.me/posts/archlinux-pavilion-gaming-laptop/" />
    <id>https://blog.starry-s.me/posts/archlinux-pavilion-gaming-laptop/</id>
    
    <published>2020-07-19T07:29:57.000Z</published>
    
    
    <updated>2020-07-19T07:29:57.000Z</updated>
    
    
    <summary type="html">
      <![CDATA[<p>自从高中毕业至今这台笔记本用了将近两年，已经记不清当初为什么买了这台笔记本，刚买来电脑第一次装Arch Linux时遇到了一些坑，不过大多数的问题Google折腾一会或随着后续的软件更新基本上就都解决了，唯独配置双显卡这个问题在用了两年后才算是找到了比较满意的解决方法（大概是），<del>尽管现在这电脑已经停产了，就算有人买了这台电脑也不一定会拿他装Arch Linux，不过我还是打算把这个问题的解决过程记录一下</del>（本篇讲的方法应该是适用于大多数N卡+i卡的笔记本电脑的，只是有些细节不一样），以备我后续重装系统时有个参考。</p>]]>
    </summary>
    
    
    <content type="html">
      <![CDATA[<link href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" rel="stylesheet"><script src= "https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><p>自从高中毕业至今这台笔记本用了将近两年，已经记不清当初为什么买了这台笔记本，刚买来电脑第一次装Arch Linux时遇到了一些坑，不过大多数的问题Google折腾一会或随着后续的软件更新基本上就都解决了，唯独配置双显卡这个问题在用了两年后才算是找到了比较满意的解决方法（大概是），<del>尽管现在这电脑已经停产了，就算有人买了这台电脑也不一定会拿他装Arch Linux，不过我还是打算把这个问题的解决过程记录一下</del>（本篇讲的方法应该是适用于大多数N卡+i卡的笔记本电脑的，只是有些细节不一样），以备我后续重装系统时有个参考。</p><a id="more"></a><hr>                     <div id="aplayer0"></div>                    <script>                    const ap0 = new APlayer ({                        container: document.getElementById("aplayer0"),                        theme: "#33363b",                        fixed: false,                        listFolded: false,                        listMaxHeight: false,                        lrcType: false,                        mini: false,                        volume: 0.7,                        order: "list",                        loop: "all",                        autoplay: false,                        audio: [{                            name: "Kaleidoscope",                            artist: "Vicetone / Grace Grundy",                            url: "https://music.starry-s.me/music/560e_0558_060b_adc45c798222ffa86a4d1a0cb6ddf18f.m4a",                            cover: "https://music.starry-s.me/music/cover/18671906464338403.jpg",                            lrc: "",                            theme: "#A26208"                        }]                    });                    </script>  <h1 id="先描述一下踩坑经过"><a class="header-link" href="/posts/archlinux-pavilion-gaming-laptop/#%E5%85%88%E6%8F%8F%E8%BF%B0%E4%B8%80%E4%B8%8B%E8%B8%A9%E5%9D%91%E7%BB%8F%E8%BF%87" title="先描述一下踩坑经过"></a>先描述一下踩坑经过</h1><blockquote><p>本段略微有些废话，可以跳过</p></blockquote><p>记得在刚买来这台笔记本（2018年夏），Linux内核还没升到5.0的时候，使用live CD装系统时会遇到<code>lspci</code>卡死，关机的时候会卡死的问题，查系统日记都是一堆ACPI的报错。当时网上查了一下大概是内核和驱动一些bug，没找到解决办法（补充：是nouveau的问题，内核参数添加<code>modprobe.blacklist=nouveau</code>禁用可以暂时解决问题），Google到论坛的帖子说是在关机/重启发生卡死时直接长按电源关机就好了，对电脑没有影响（找不到搜的回答了）</p><p>装完系统后安装显卡驱动时想通过Bumblebee + bbswitch切换双显卡，于是装了Gnome然后照着wiki配置完Bumblebee后重启电脑直接死机（补充：应该是bbswitch导致的ACPI锁死）。</p><p>经过多次重装系统的折磨后，发现只装Bumblebee不装bbswitch不<code>systemctl enable bumblebeed.service</code>时，能正常开机，然后之前遇到的两个问题也莫名其妙就好了，即系统重启关机不会卡死，<code>lspci</code>也正常了（迷）</p><p>之后，在不装bbswitch的情况下，<code>systemctl enable bumblebeed</code>再用<code>optirun</code>和<code>primusrun</code>这种方式用独显运行程序都没有问题。</p><p>当时以为电脑不装bumblebee的话就没法正常关机，于是就一直用着bumblebee切换双显卡，玩游戏性能比Windows下差一点（貌似是显卡驱动的锅？），别的都没啥问题。</p><p>今年年初买了一块拓展屏想搞双显示器，本来显示器应该插上HDMI直接就能用的，但是因为这电脑的HDMI走的独显输出，Bumblebee不能直接用，wiki上教的创建个intel的虚拟输出啥的方法有试过但是没成功过（不知道是配置文件写错了还是啥问题），于是又Google了一下后disable并卸了Bumblebee改用<a href="https://wiki.archlinux.org/index.php/NVIDIA_Optimus#Use_NVIDIA_graphics_only" target="_blank" rel="noreferrer noopener">NVIDIA Optimus 只使用独显</a>的方式，这样双显示器倒是能用了，但是如果笔记本只用电池没连着拓展屏的时候还跑着独显这也太费电了。</p><p>所以最后找到了能切换显卡的<a href="https://github.com/Askannz/optimus-manager" target="_blank" rel="noreferrer noopener">Optimus Manager</a>。</p><h1 id="安装过程"><a class="header-link" href="/posts/archlinux-pavilion-gaming-laptop/#%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B" title="安装过程"></a>安装过程</h1><p>照着<a href="https://wiki.archlinux.org/index.php/NVIDIA_Optimus" target="_blank" rel="noreferrer noopener">Wiki</a>和Optimus Manager的<a href="https://github.com/Askannz/optimus-manager#optimus-manager" target="_blank" rel="noreferrer noopener">README</a>。首先安装好显卡驱动相关的软件，如果有Bumblebee的话使用<code>systemctl disable bumblebeed</code>停用。</p><p>首先清除（记得备份）<code>/etc/X11/xorg.conf.d/</code>下的配置文件，并删掉（记得备份）<code>/etc/X11/xorg.conf</code>（如果有的话），因为Optimus Manager会自动生成配置文件存放到<code>/etc/X11/xorg.conf.d/</code>里面，所以建议安装前把显示配置相关的文件都清除掉。</p><p>使用Arch Linux CN源或者通过AUR Helper安装<code>optimus-manager</code>。</p><figure data-raw="# Arch Linux CN$ sudo pacman -S optimus-manager# AUR$ yay -S optimus-manager" class="code-block highlight hljs"><pre class="gutter"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span></pre><pre class="code"><code class="language-elixir"><span class="hljs-comment"># Arch Linux CN</span><span class="hljs-variable">$ </span>sudo pacman -S optimus-manager<span class="hljs-comment"># AUR</span><span class="hljs-variable">$ </span>yay -S optimus-manager</code></pre></figure><p>因为我用的Gnome，参照<a href="https://github.com/Askannz/optimus-manager#important--gnome-and-gdm-users" target="_blank" rel="noreferrer noopener">README中说的</a>卸载掉<code>gdm</code>并安装<code>gdm-prime</code><sup>AUR</sup>。（国内下载源代码的速度极慢建议挂梯子，或者挂梯子克隆<a href="https://gitlab.gnome.org/GNOME/gdm" target="_blank" rel="noreferrer noopener">GDM的代码</a>到<code>~/.cache/yay/gdm-prime/gdm</code>下。）</p><p>修改<code>/etc/gdm/custom.conf</code>，移除<code>WaylandEnable=false</code>一行前面的<code>#</code>禁用Wayland而使用X。</p><h2 id="修改配置文件"><a class="header-link" href="/posts/archlinux-pavilion-gaming-laptop/#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" title="修改配置文件"></a>修改配置文件</h2><figure data-raw="$ sudo cp /usr/share/optimus-manager.conf /etc/optimus-manager/optimus-manager.conf" class="code-block highlight hljs"><pre class="gutter"><span class="line-number">1</span></pre><pre class="code"><code class="language-awk">$ sudo cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/optimus-manager.conf /</span>etc<span class="hljs-regexp">/optimus-manager/</span>optimus-manager.conf</code></pre></figure><p>不要编辑<code>/usr/share/</code>下的文件，编辑<code>/etc/optimus-manager/optimus-manager.conf</code>，将切换方式设为<code>switching=none</code>，不推荐使用bbswitch（见<a href="/posts/archlinux-pavilion-gaming-laptop/#Others">后续第一条</a>），设置<code>pci_power_control=yes</code>让PCI Power Management切换显卡。</p><p>之后根据需求来修改开机自动选择显卡：</p><figure data-raw="startup_mode=autostartup_auto_battery_mode=intelstartup_auto_extpower_mode=nvidia" data-info="language-conf" data-lang="conf" class="code-block highlight hljs"><pre class="gutter"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></pre><pre class="code"><code class="language-ini"><span class="hljs-attr">startup_mode</span>=auto<span class="hljs-attr">startup_auto_battery_mode</span>=intel<span class="hljs-attr">startup_auto_extpower_mode</span>=nvidia</code></pre></figure><p>这里我设置的是用电池时使用集成显卡，用电源时使用独显。</p><p>最后贴一下全部的配置文件，除了上述的几处修改以外其他均为默认值，仅供参考。</p><figure data-raw="[optimus]# This parameter defines the method used to power switch the Nvidia card. See the documentation# for a complete description of what each value does. Possible values :## - nouveau : load the nouveau module on the Nvidia card.# - bbswitch : power off the card using the bbswitch module (requires the bbswitch dependency).# - acpi_call : try various ACPI method calls to power the card on and off (requires the acpi_call dependency)# - custom: use custom scripts at /etc/optimus-manager/nvidia-enable.sh and /etc/optimus-manager/nvidia-disable.sh# - none : do not use an external module for power management. For some laptop models it's preferable to#          use this option in combination with pci_power_control (see below).switching=none# Enable PCI power management in Intel mode.# This option is incompatible with acpi_call and bbswitch, so it will be ignored in those cases.pci_power_control=yes# Remove the Nvidia card from the PCI bus.# May prevent crashes caused by power switching.# Ignored if switching=nouveau or switching=bbswitch.pci_remove=yes# Reset the Nvidia card at the PCI level before reloading the nvidia module.# Ensures the card is in a fresh state before reloading the nvidia module.# May fix some switching issues. Possible values :## - no : does not perform any reset# - function_level : perform a light &quot;function-level&quot; reset# - hot_reset : perform a &quot;hot reset&quot; of the PCI bridge. ATTENTION : this method messes with the hardware#         directly, please read the online documentation of optimus-manager before using it.#         Also, it will perform a PCI remove even if pci_remove=no.#pci_reset=no# Automatically log out the current desktop session when switching GPUs.# This feature is currently supported for the following DE/WM :# KDE Plasma, GNOME, XFCE, LXDE, Deepin, i3, Openbox, AwesomeWM, bspwm# If this option is disabled or you use a different desktop environment,# GPU switching only becomes effective at the next graphical session login.auto_logout=yes# GPU mode to use at computer startup. Possible values: nvidia, intel, hybrid, auto# &quot;auto&quot; is a special mode that auto-detects if the computer is running on battery# and selects a proper GPU mode. See the other options below.startup_mode=auto# GPU mode to select when startup_mode=auto and the computer is running on battery.# Possible values: nvidia, intel, hybridstartup_auto_battery_mode=intel# GPU mode to select when startup_mode=auto and the computer is running on external power.# Possible values: nvidia, intel, hybridstartup_auto_extpower_mode=nvidia[intel]# Driver to use for the Intel GPU. Possible values : modesetting, intel# To use the intel driver, you need to install the package &quot;xf86-video-intel&quot;.driver=modesetting# Acceleration method (corresponds to AccelMethod in the Xorg configuration).# Only applies to the intel driver.# Possible values : sna, xna, uxa# Leave blank for the default (no option specified)accel=# Enable TearFree option in the Xorg configuration.# Only applies to the intel driver.# Possible values : yes, no# Leave blank for the default (no option specified)tearfree=# DRI version. Possible values : 2, 3DRI=3# Whether or not to enable modesetting for the nouveau driver.# Does not affect modesetting for the Intel GPU driver !# This option only matters if you use nouveau as the switching backend.modeset=yes[nvidia]# Whether or not to enable modesetting. Required for PRIME Synchronization (which prevents tearing).modeset=yes# Whether or not to enable the NVreg_UsePageAttributeTable option in the Nvidia driver.# Recommended, can cause poor CPU performance otherwise.PAT=yes# DPI value. This will be set using the Xsetup script passed to your login manager.# It will run the command# xrandr --dpi <DPI># Leave blank for the default (the above command will not be run).DPI=96# If you're running an updated version of xorg-server (let's say to get PRIME Render offload enabled),# the nvidia driver may not load because of an ABI version mismatch. Setting this flag to &quot;yes&quot;# will allow the loading of the nvidia driver.ignore_abi=no# Set to yes if you want to use optimus-manager with external Nvidia GPUs (experimental)allow_external_gpus=no# Comma-separated list of Nvidia-specific options to apply.# Available options :# - overclocking : enable CoolBits in the Xorg configuration, which unlocks clocking options#   in the Nvidia control panel. Note: does not work in hybrid mode.# - triple_buffer : enable triple buffering.options=overclocking" data-info="language-conf" data-lang="conf" class="code-block highlight hljs"><pre class="gutter"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span><span class="line-number">33</span><span class="line-number">34</span><span class="line-number">35</span><span class="line-number">36</span><span class="line-number">37</span><span class="line-number">38</span><span class="line-number">39</span><span class="line-number">40</span><span class="line-number">41</span><span class="line-number">42</span><span class="line-number">43</span><span class="line-number">44</span><span class="line-number">45</span><span class="line-number">46</span><span class="line-number">47</span><span class="line-number">48</span><span class="line-number">49</span><span class="line-number">50</span><span class="line-number">51</span><span class="line-number">52</span><span class="line-number">53</span><span class="line-number">54</span><span class="line-number">55</span><span class="line-number">56</span><span class="line-number">57</span><span class="line-number">58</span><span class="line-number">59</span><span class="line-number">60</span><span class="line-number">61</span><span class="line-number">62</span><span class="line-number">63</span><span class="line-number">64</span><span class="line-number">65</span><span class="line-number">66</span><span class="line-number">67</span><span class="line-number">68</span><span class="line-number">69</span><span class="line-number">70</span><span class="line-number">71</span><span class="line-number">72</span><span class="line-number">73</span><span class="line-number">74</span><span class="line-number">75</span><span class="line-number">76</span><span class="line-number">77</span><span class="line-number">78</span><span class="line-number">79</span><span class="line-number">80</span><span class="line-number">81</span><span class="line-number">82</span><span class="line-number">83</span><span class="line-number">84</span><span class="line-number">85</span><span class="line-number">86</span><span class="line-number">87</span><span class="line-number">88</span><span class="line-number">89</span><span class="line-number">90</span><span class="line-number">91</span><span class="line-number">92</span><span class="line-number">93</span><span class="line-number">94</span><span class="line-number">95</span><span class="line-number">96</span><span class="line-number">97</span><span class="line-number">98</span><span class="line-number">99</span><span class="line-number">100</span><span class="line-number">101</span><span class="line-number">102</span><span class="line-number">103</span><span class="line-number">104</span><span class="line-number">105</span><span class="line-number">106</span><span class="line-number">107</span><span class="line-number">108</span><span class="line-number">109</span></pre><pre class="code"><code class="language-routeros">[optimus]<span class="hljs-comment"># This parameter defines the method used to power switch the Nvidia card. See the documentation</span><span class="hljs-comment"># for a complete description of what each value does. Possible values :</span><span class="hljs-comment">#</span><span class="hljs-comment"># - nouveau : load the nouveau module on the Nvidia card.</span><span class="hljs-comment"># - bbswitch : power off the card using the bbswitch module (requires the bbswitch dependency).</span><span class="hljs-comment"># - acpi_call : try various ACPI method calls to power the card on and off (requires the acpi_call dependency)</span><span class="hljs-comment"># - custom: use custom scripts at /etc/optimus-manager/nvidia-enable.sh and /etc/optimus-manager/nvidia-disable.sh</span><span class="hljs-comment"># - none : do not use an external module for power management. For some laptop models it's preferable to</span><span class="hljs-comment">#          use this option in combination with pci_power_control (see below).</span><span class="hljs-attribute">switching</span>=none<span class="hljs-comment"># Enable PCI power management in Intel mode.</span><span class="hljs-comment"># This option is incompatible with acpi_call and bbswitch, so it will be ignored in those cases.</span><span class="hljs-attribute">pci_power_control</span>=<span class="hljs-literal">yes</span><span class="hljs-comment"># Remove the Nvidia card from the PCI bus.</span><span class="hljs-comment"># May prevent crashes caused by power switching.</span><span class="hljs-comment"># Ignored if switching=nouveau or switching=bbswitch.</span><span class="hljs-attribute">pci_remove</span>=<span class="hljs-literal">yes</span><span class="hljs-comment"># Reset the Nvidia card at the PCI level before reloading the nvidia module.</span><span class="hljs-comment"># Ensures the card is in a fresh state before reloading the nvidia module.</span><span class="hljs-comment"># May fix some switching issues. Possible values :</span><span class="hljs-comment">#</span><span class="hljs-comment"># - no : does not perform any reset</span><span class="hljs-comment"># - function_level : perform a light "function-level" reset</span><span class="hljs-comment"># - hot_reset : perform a "hot reset" of the PCI bridge. ATTENTION : this method messes with the hardware</span><span class="hljs-comment">#         directly, please read the online documentation of optimus-manager before using it.</span><span class="hljs-comment">#         Also, it will perform a PCI remove even if pci_remove=no.</span><span class="hljs-comment">#</span><span class="hljs-attribute">pci_reset</span>=<span class="hljs-literal">no</span><span class="hljs-comment"># Automatically log out the current desktop session when switching GPUs.</span><span class="hljs-comment"># This feature is currently supported for the following DE/WM :</span><span class="hljs-comment"># KDE Plasma, GNOME, XFCE, LXDE, Deepin, i3, Openbox, AwesomeWM, bspwm</span><span class="hljs-comment"># If this option is disabled or you use a different desktop environment,</span><span class="hljs-comment"># GPU switching only becomes effective at the next graphical session login.</span><span class="hljs-attribute">auto_logout</span>=<span class="hljs-literal">yes</span><span class="hljs-comment"># GPU mode to use at computer startup. Possible values: nvidia, intel, hybrid, auto</span><span class="hljs-comment"># "auto" is a special mode that auto-detects if the computer is running on battery</span><span class="hljs-comment"># and selects a proper GPU mode. See the other options below.</span><span class="hljs-attribute">startup_mode</span>=auto<span class="hljs-comment"># GPU mode to select when startup_mode=auto and the computer is running on battery.</span><span class="hljs-comment"># Possible values: nvidia, intel, hybrid</span><span class="hljs-attribute">startup_auto_battery_mode</span>=intel<span class="hljs-comment"># GPU mode to select when startup_mode=auto and the computer is running on external power.</span><span class="hljs-comment"># Possible values: nvidia, intel, hybrid</span><span class="hljs-attribute">startup_auto_extpower_mode</span>=nvidia[intel]<span class="hljs-comment"># Driver to use for the Intel GPU. Possible values : modesetting, intel</span><span class="hljs-comment"># To use the intel driver, you need to install the package "xf86-video-intel".</span><span class="hljs-attribute">driver</span>=modesetting<span class="hljs-comment"># Acceleration method (corresponds to AccelMethod in the Xorg configuration).</span><span class="hljs-comment"># Only applies to the intel driver.</span><span class="hljs-comment"># Possible values : sna, xna, uxa</span><span class="hljs-comment"># Leave blank for the default (no option specified)</span>accel=<span class="hljs-comment"># Enable TearFree option in the Xorg configuration.</span><span class="hljs-comment"># Only applies to the intel driver.</span><span class="hljs-comment"># Possible values : yes, no</span><span class="hljs-comment"># Leave blank for the default (no option specified)</span>tearfree=<span class="hljs-comment"># DRI version. Possible values : 2, 3</span><span class="hljs-attribute">DRI</span>=3<span class="hljs-comment"># Whether or not to enable modesetting for the nouveau driver.</span><span class="hljs-comment"># Does not affect modesetting for the Intel GPU driver !</span><span class="hljs-comment"># This option only matters if you use nouveau as the switching backend.</span><span class="hljs-attribute">modeset</span>=<span class="hljs-literal">yes</span>[nvidia]<span class="hljs-comment"># Whether or not to enable modesetting. Required for PRIME Synchronization (which prevents tearing).</span><span class="hljs-attribute">modeset</span>=<span class="hljs-literal">yes</span><span class="hljs-comment"># Whether or not to enable the NVreg_UsePageAttributeTable option in the Nvidia driver.</span><span class="hljs-comment"># Recommended, can cause poor CPU performance otherwise.</span><span class="hljs-attribute">PAT</span>=<span class="hljs-literal">yes</span><span class="hljs-comment"># DPI value. This will be set using the Xsetup script passed to your login manager.</span><span class="hljs-comment"># It will run the command</span><span class="hljs-comment"># xrandr --dpi &lt;DPI&gt;</span><span class="hljs-comment"># Leave blank for the default (the above command will not be run).</span><span class="hljs-attribute">DPI</span>=96<span class="hljs-comment"># If you're running an updated version of xorg-server (let's say to get PRIME Render offload enabled),</span><span class="hljs-comment"># the nvidia driver may not load because of an ABI version mismatch. Setting this flag to "yes"</span><span class="hljs-comment"># will allow the loading of the nvidia driver.</span><span class="hljs-attribute">ignore_abi</span>=<span class="hljs-literal">no</span><span class="hljs-comment"># Set to yes if you want to use optimus-manager with external Nvidia GPUs (experimental)</span><span class="hljs-attribute">allow_external_gpus</span>=<span class="hljs-literal">no</span><span class="hljs-comment"># Comma-separated list of Nvidia-specific options to apply.</span><span class="hljs-comment"># Available options :</span><span class="hljs-comment"># - overclocking : enable CoolBits in the Xorg configuration, which unlocks clocking options</span><span class="hljs-comment">#   in the Nvidia control panel. <span class="hljs-doctag">Note:</span> does not work in hybrid mode.</span><span class="hljs-comment"># - triple_buffer : enable triple buffering.</span><span class="hljs-attribute">options</span>=overclocking</code></pre></figure><h1 id="食用方法"><a class="header-link" href="/posts/archlinux-pavilion-gaming-laptop/#%E9%A3%9F%E7%94%A8%E6%96%B9%E6%B3%95" title="食用方法"></a>食用方法</h1><p><code>optimus-manager --switch nvidia</code>切换到独显（nvidia）；</p><p><code>optimus-manager --switch intel</code>切换到集显（intel）</p><p>其他用法参见<a href="https://github.com/Askannz/optimus-manager#usage" target="_blank" rel="noreferrer noopener">Usage</a>。</p><p>注意：</p><ul><li><p>切换显卡的过程中会自动注销登录，所以记得<strong>保存并关掉电脑正在运行的程序</strong>。</p></li><li><p>你可以在配置文件中修改<code>auto_logout=false</code>禁止自动注销以手动注销切换显卡。</p></li></ul><h1 id="Others"><a class="header-link" href="/posts/archlinux-pavilion-gaming-laptop/#Others" title="Others"></a>Others</h1><ul><li><p>之所以不推荐使用<code>bbswitch</code>是因为容易遇到<strong>ACPI锁死</strong>的问题，<a href="https://wiki.archlinux.org/index.php/NVIDIA_Optimus#Lockup_issue_(lspci_hangs)" target="_blank" rel="noreferrer noopener">参考Wiki</a>，需要添加<a href="https://wiki.archlinux.org/index.php/Kernel_parameters" target="_blank" rel="noreferrer noopener">内核参数</a><code>acpi_osi=! acpi_osi="Windows 2009"</code>或<code>acpi_osi="!Windows 2015"</code>启动，如果你遇到了锁死可以通过开机时在<a href="https://wiki.archlinux.org/index.php/Arch_boot_process#Boot_loader" target="_blank" rel="noreferrer noopener">启动加载器界面</a>编辑添加内核参数来正常进入系统，如果你用的是efistub或者没办法编辑内核参数的话就只能用live CD救你的电脑了。</p></li><li><p>如果用不了<code>lspci</code>，电脑没法正常关机的话，是nouveau的问题，可添加内核参数<code>modprobe.blacklist=nouveau</code>禁用。</p></li><li><p>因为前几天改配置文件时又踩了一遍锁死的坑，于是拿着相机内存卡（我U盘放学校寝室里拿不出来了）做了最新的(2020.07.01)live CD救砖时，惊喜的发现在live环境下<code>lspci</code>和关机都不会卡死了，<del>貌似是新版内核驱动修复了nouveau的问题</del> 应该是我在几个月前升级了电脑的Bios，解决的这个问题，因为我又新下了一个旧的live CD，关机和lspci也都正常了（算了不管到底是怎么回事了，能用就行</p></li><li><p>在切换显卡自动注销后，gdm界面不会自动加载出来而是一直黑屏，这时需要手动切换到tty2再切回tty1才能加载出来，貌似是gdm-prime的问题。</p></li></ul><hr><div align="center">    <img src="/posts/archlinux-pavilion-gaming-laptop/images/1.png"></div>]]>
    </content>
    
    
    <category term="Linux" label="Linux" scheme="https://blog.starry-s.me/categories/Linux/" />
    
    
    <category term="Arch Linux" label="Arch Linux" scheme="https://blog.starry-s.me/tags/Arch%20Linux/" />
    
    <category term="NVIDIA Optimus" label="NVIDIA Optimus" scheme="https://blog.starry-s.me/tags/NVIDIA%20Optimus/" />
    
  </entry>
  
  
  
  <entry>
    <title>Everything is based on "Hello World".</title>
    <link rel="alternate" type="text/html" href="https://blog.starry-s.me/posts/hello-world/" />
    <id>https://blog.starry-s.me/posts/hello-world/</id>
    
    <published>2016-08-22T06:22:54.000Z</published>
    
    
    <updated>2016-08-22T06:22:54.000Z</updated>
    
    
    <summary type="html">
      <![CDATA[<link href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" rel="stylesheet"><script src= "https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><p><img src="/posts/hello-world/images/image.jpg" alt="&quot;Hello World&quot;" title="Hello World"></p>                     <div id="aplayer0"></div>                    <script>                    const ap0 = new APlayer ({                        container: document.getElementById("aplayer0"),                        theme: "#33363b",                        fixed: false,                        listFolded: false,                        listMaxHeight: false,                        lrcType: false,                        mini: false,                        volume: 0.7,                        order: "list",                        loop: "all",                        autoplay: false,                        audio: [{                            name: "遊園施設",                            artist: "帆足圭吾",                            url: "https://music.starry-s.me/music/540b_075e_0453_cae9f8037d04c81f84993977b01792ec.m4a",                            cover: "https://music.starry-s.me/music/cover/18710389371705314.jpg",                            lrc: "",                            theme: "#67B577"                        }]                    });                    </script> ]]>
    </summary>
    
    
    <content type="html">
      <![CDATA[<link href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" rel="stylesheet"><script src= "https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><p><img src="/posts/hello-world/images/image.jpg" alt="&quot;Hello World&quot;" title="Hello World"></p>                     <div id="aplayer0"></div>                    <script>                    const ap0 = new APlayer ({                        container: document.getElementById("aplayer0"),                        theme: "#33363b",                        fixed: false,                        listFolded: false,                        listMaxHeight: false,                        lrcType: false,                        mini: false,                        volume: 0.7,                        order: "list",                        loop: "all",                        autoplay: false,                        audio: [{                            name: "遊園施設",                            artist: "帆足圭吾",                            url: "https://music.starry-s.me/music/540b_075e_0453_cae9f8037d04c81f84993977b01792ec.m4a",                            cover: "https://music.starry-s.me/music/cover/18710389371705314.jpg",                            lrc: "",                            theme: "#67B577"                        }]                    });                    </script> <a id="more"></a><hr><figure data-raw="#include <stdio.h>int main(int argc, char *argv[]){    printf(&quot;Hello World!\n&quot;);    return 0;}" data-info="language-C" data-lang="C" class="code-block highlight hljs"><pre class="gutter"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></pre><pre class="code"><code class="language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span>{    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello World!\n"</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre></figure><h2 id="STARRY-S039;Blog"><a class="header-link" href="/posts/hello-world/#STARRY-S039;Blog" title="STARRY-S039;Blog"></a>STARRY-S' Blog</h2>]]>
    </content>
    
    
    <category term="Hello World" label="Hello World" scheme="https://blog.starry-s.me/categories/Hello%20World/" />
    
    
    <category term="Hello World" label="Hello World" scheme="https://blog.starry-s.me/tags/Hello%20World/" />
    
  </entry>
  
  
</feed>
